#!/bin/bash
set -euo pipefail
filepath=$1
[ ! -z "${clean:-}" ] && echo :cleaned >&2 && rm -rf "$(cljs-root $filepath)"
root=$(cljs-root $filepath)
echo :releasing >&2
cljs-make-proj $filepath
cljs-update $filepath
cd $root
rm -f package.json*
echo :recompiling >&2
lein cljsbuild once release
mv out-release/release.js* .
rm -rf out-release
if cljs-deps $filepath :browser-mode; then
ln -sf $root/index.html.release $root/index.html
fi
