#!/bin/bash
set -euo pipefail
filepath=$1
[ ! -z "${clean:-}" ] && echo :cleaned >&2 && rm -rf "$(cljs-root $filepath)"
root=$(cljs-root $filepath)
echo :releasing >&2
cljs-make-proj $filepath
cljs-update $filepath
if cljs-deps $filepath :browser-mode &>/dev/null; then
    cp -f $root/index.html.release $root/index.html
fi
cd $root
echo :recompiling >&2
lein cljsbuild once release 1>&2
mv out-release/release.js* .
