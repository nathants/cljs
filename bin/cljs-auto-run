#!/bin/bash
set -e
filepath=$1
root=$(cljs-root $filepath)
now=$(cat $root/compiled.log|wc -l)
if cljs-update $filepath; then
    while true; do
        if [ "$now" != "$(cat $root/compiled.log|wc -l)" ]; then
            tail -n1 $root/compiled.log
            break
        fi
        sleep .025
    done
fi
shift
node $root/run.js "$@"
